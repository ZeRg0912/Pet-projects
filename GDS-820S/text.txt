ChatGPT (беседа № 2):
Выбрана Ваша роль: Программист

Вот пример программы на C++ для управления Keithley 2430 через COM-порт и использования SCPI команд:

#include <iostream>
#include <Windows.h>

int main()
{
    HANDLE hPort;
    char buffer[256];
    DWORD bytesRead;

    // Открытие COM-порта
    hPort = CreateFile("COM1", GENERIC_READ | GENERIC_WRITE, 0, NULL, OPEN_EXISTING, 0, NULL);
    if (hPort == INVALID_HANDLE_VALUE)
    {
        std::cout << "Ошибка открытия COM-порта" << std::endl;
        return 1;
    }

    // Установка конфигурации COM-порта
    DCB dcb;
    GetCommState(hPort, &dcb);
    dcb.BaudRate = CBR_9600;
    dcb.ByteSize = 8;
    dcb.StopBits = ONESTOPBIT;
    dcb.Parity = NOPARITY;
    SetCommState(hPort, &dcb);

    // Получение ID устройства
    DWORD bytesWritten;
    WriteFile(hPort, "*IDN?\n", 6, &bytesWritten, NULL);
    ReadFile(hPort, buffer, 256, &bytesRead, NULL);
    buffer[bytesRead] = '\0';
    std::cout << "ID устройства: " << buffer << std::endl;

    // Выставление напряжения и тока
    WriteFile(hPort, ":SOUR:VOLT 10\n", 14, &bytesWritten, NULL);
    WriteFile(hPort, ":SOUR:CURR 0.1\n", 15, &bytesWritten, NULL);

    // Включение считывания тока и вывод на консоль
    WriteFile(hPort, ":SENS:FUNC 'CURR'\n", 18, &bytesWritten, NULL);
    while (true)
    {
        // Запрос тока
        WriteFile(hPort, "READ?\n", 6, &bytesWritten, NULL);
        ReadFile(hPort, buffer, 256, &bytesRead, NULL);
        buffer[bytesRead] = '\0';
        std::cout << "Ток: " << buffer;

        // Задержка перед повторным запросом
        Sleep(1000);
    }

    // Закрытие COM-порта
    CloseHandle(hPort);

    return 0;
}

Пожалуйста, убедитесь, что COM-порт (например, COM1) и настройки соответствуют вашей конфигурации. Также убедитесь, что у вас установлены необходимые драйверы для COM-порта и Keithley 2430.

Программа открывает COM-порт, устанавливает конфигурацию порта, отправляет SCPI команды для получения ID устройства, выставления напряжения и тока, а затем считывает постоянный ток и выводит его на консоль, обновляя значение каждую секунду.

890 из 16384